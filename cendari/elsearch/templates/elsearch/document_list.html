{% extends 'base.html' %}

{% load staticfiles %}
{% load facet_tags %}

{% block css %}
<link rel="stylesheet" href="{% static "bootstrap/css/bootstrap.min.css" %}">
<link rel="stylesheet" href="{% static "jquery-ui-1.8.18.custom/jquery-ui-1.8.18.custom.css" %}">
<link rel="stylesheet" href="{% static "css/facetview.css" %}">
<style type="text/css">

  .container {
      height: 1%;
  }

  dd {
      font-size: small;
  }

  .leftpanel {
      float: left;
      padding: 5px;
      width: 200px;
      border: 1px solid black;
  }
  .mainpanel {
      padding: 5px;
      margin-left: 210px;
  }
  .highlighted {
    background: #faa732;
    padding: 2px;
  }
  .searchresult > a * {
    display: inline;
  }
  .searchresult {
    margin-bottom: .75em;
  }

  .facetclass {
    list-style: none;
  }
</style>
{% endblock %}

{% block js %}
<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<script type="text/javascript" src="{% static "bootstrap/js/bootstrap.js" %}"></script>
<script type="text/javascript" src="{% static "linkify/1.0/jquery.linkify-1.0-min.js" %}"></script>
<script type="text/javascript" src="{% static "jquery-ui-1.8.18.custom/jquery-ui-1.8.18.custom.min.js" %}"></script>
<script type="text/javascript" src="{% static "js/jquery.facetview.js" %}"></script>

<script type="text/javascript">
    var showfiltervals = function(event) {
	event.preventDefault();
	if ( $(this).hasClass('facetview_open') ) {
	    $(this).children('i').removeClass('icon-minus');
	    $(this).children('i').addClass('icon-plus');
	    $(this).removeClass('facetview_open');
	    $('[id="facetview_' + $(this).attr('rel') +'"]').children().find('.facetview_filtervalue').hide();
	    $(this).siblings('.facetview_filteroptions').hide();
	} else {
	    $(this).children('i').removeClass('icon-plus');
	    $(this).children('i').addClass('icon-minus');
	    $(this).addClass('facetview_open');
	    $('[id="facetview_' + $(this).attr('rel') +'"]').children().find('.facetview_filtervalue').show();
	    $(this).siblings('.facetview_filteroptions').show();
	}
    };
</script>

{% endblock %}

{% block content %}
<form method="get" action=".">
  <p>
    {{ form }}
    <input type="submit" value="Search">
  </p>

<!-- Begin faceting. -->
<div style="clear:both;" class="btn-toolbar" id="facetview_selectedfilters">
</div>
<div class="leftpanel facetpane">
  <h2>Facets (<a href="?q=">reset</a>)</h2>
  <hr>
  {% for fclass, values, applied in facets %}
    {% if values %}
        <ul class="facetclass">
            {% for value in values %}
                <li class="facetvalue">
                {% with fclass|facet_param:value.term as param %}
                {% if value.term in applied %}
                    <input type="hidden" name="{{fclass.param}}" value="{{value.term}}"/>
                     <span class="selected-filter">
                    {{fclass|facet_render:value.term}}<a class="remove-filter"
                        href="{{request.path|removeparam:param|stripparam:"page,sort"}}">
                            <i class="icon-remove"></i>
                        </a>
                    </span>
                {% else %}
                     <a href="{{request.path|addparam:param|stripparam:"page,sort"}}">{{fclass|facet_render:value.term}}</a>
                 {% endif %}
                
                {% endwith %}
                </li>
            {% endfor %}
        </ul>
    {% endif %}
  {% endfor %}
</div>

<script type="text/javascript">
    $('.facetview_filtershow').bind('click',showfiltervals);
</script>
    <!-- End faceting -->

<div class="container">
<div class="mainpanel">
  <h2>Results ({{ page.paginator.count }}) 
    {% if page.has_previous %}<a href="?q={{ query }}&amp;page=1">1</a>
<a href="?q={{ query }}&amp;page={{ page.previous_page_number }}">{% endif %}&laquo; Prev {% if page.has_previous %}</a>{% endif %} 
    | {{ page.number }} | 
    {% if page.has_next %}<a href="?q={{ query }}&amp;page={{ page.next_page_number }}">{% endif %}Next &raquo;{% if page.has_next %}</a>
    <a href="?q={{ query }}&amp;page={{ page.paginator.num_pages }}">{{ page.paginator.num_pages }}</a>{% endif %}
  </h2>
  <hr>

  <ol>
    {% for result in page.object_list %}
    <li>
      <a href="{% url "document" result.id %}">{{ result.id }}</a>
      <div>
          {{ result.text }}
      </div>
    </li>
    {% empty %}
    <li>No results found.</li>
    {% endfor %}
  </ol>
  
  {% if page.has_previous or page.has_next %}
  <div>
    {% if page.has_previous %}<a href="?q={{ query }}&amp;page=1">1</a>
<a href="?q={{ query }}&amp;page={{ page.previous_page_number }}">{% endif %}&laquo; Prev {% if page.has_previous %}</a>{% endif %} 
    | {{ page.number }} | 
    {% if page.has_next %}<a href="?q={{ query }}&amp;page={{ page.next_page_number }}">{% endif %}Next &raquo;{% if page.has_next %}</a>
    <a href="?q={{ query }}&amp;page={{ page.paginator.num_pages }}">{{ page.paginator.num_pages }}</a>{% endif %}
    {% endif %}
</div>
</div>
</form>
{% endblock %}
